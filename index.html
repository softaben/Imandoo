<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>قائمة طعام Imandou Food</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    /* ... Style section is unchanged ... */
    :root{ --bg: #0f172a; --card: #0b1220; --text: #e2e8f0; --muted: #94a3b8; --accent: #fbbf24; --radius-lg: 14px; --radius-md: 8px; --success: #10b981; --danger: #ef4444; } html { scroll-behavior: smooth; } body { font-family: 'Cairo', 'Inter', sans-serif; background: var(--bg); color: var(--text); -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; overflow-x: hidden; } body::before { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: var(--background-image, url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&q=80&w=2070')); background-size: cover; background-position: center; opacity: 0.08; z-index: -1; transition: background-image 0.5s ease-in-out; } .app { max-width: 480px; margin: 0 auto; min-height:100vh; position: relative; z-index: 1; } @media(min-width: 768px){ .app{max-width: 820px;} } @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } } @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } } @keyframes cardEnter { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } } .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; } .animate-slide-up { animation: slideUp 0.6s ease-out forwards; } .card.is-visible { animation: cardEnter 0.5s ease-out forwards; } .card { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.04)); border-radius: var(--radius-lg); box-shadow: 0 8px 25px rgba(2,6,23,0.7); border: 1px solid rgba(255,255,255,0.04); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); } .pill { background: rgba(255,255,255,0.03); border-radius: 999px; padding: 8px 16px; font-weight:500; color:var(--text); display:inline-flex; gap:8px; align-items:center; border: 1px solid rgba(255,255,255,0.05); transition: all 0.2s ease; cursor: pointer; font-size: 0.9rem; white-space: nowrap; } .pill:hover { background: rgba(255,255,255,0.07); transform: translateY(-1px); } .pill.active { background: var(--accent); color: #0f172a; font-weight: 700; box-shadow: 0 4px 14px rgba(0,0,0,0.2); } .pill.primary { background: var(--accent); color: #0f172a; font-weight: 700; } .pill.added { background-color: var(--success); color: white; font-weight: 700; } h1, h2, h3 { font-family: 'Playfair Display', serif; font-weight: 700; } .categories-bar { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; } .categories-bar::-webkit-scrollbar { display: none; } .menu-item-card { display: flex; gap: 16px; padding: 16px; } .menu-item-image { width: 110px; height: 110px; object-fit: cover; border-radius: var(--radius-md); flex-shrink: 0; } @media (min-width: 768px) { #menuContainer { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; } } .skeleton-card { display: flex; gap: 16px; padding: 16px; margin-bottom: 16px; } .skeleton { background: rgba(255,255,255,0.05); border-radius: var(--radius-md); position: relative; overflow: hidden; } .skeleton::after { content: ''; position: absolute; top: 0; left: -150%; width: 150%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.04), transparent); animation: shimmer 1.5s infinite; } @keyframes shimmer { 0% { left: -150%; } 100% { left: 150%; } } .skeleton.image { width: 110px; height: 110px; flex-shrink: 0; } .skeleton.line { height: 20px; margin-bottom: 8px; } .skeleton.line-sm { height: 14px; } .fab { position: fixed; bottom: 20px; right: 20px; z-index: 100; width: 60px; height: 60px; border-radius: 50%; background: var(--accent); color: var(--bg); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 20px rgba(0,0,0,0.3); transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28), opacity 0.3s ease; transform: scale(0); opacity: 0; } [dir="rtl"] .fab { right: auto; left: 20px; } .fab.visible { transform: scale(1); opacity: 1; } .fab .badge-count { position: absolute; top: -2px; right: -2px; background: var(--danger); color: white; width: 24px; height: 24px; border-radius: 50%; font-size: 0.8rem; font-weight: bold; display: flex; align-items: center; justify-content: center; border: 2px solid var(--accent); } .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px; backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; } .modal.active { opacity: 1; visibility: visible; } .modal-content { transform: translateY(20px); transition: transform 0.3s ease; } .modal.active .modal-content { transform: translateY(0); } .form-input { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: var(--radius-md); padding: 12px; color: var(--text); width: 100%; margin-bottom: 12px; transition: border-color 0.2s ease; } .form-input:focus { outline: none; border-color: var(--accent); } .empty-cart-icon { font-size: 4rem; color: rgba(255,255,255,0.1); }
  </style>
</head>
<body>
  
  <div class="app p-4"><header class="text-center my-8 animate-fade-in"><h1 id="restaurantName" class="text-5xl font-bold tracking-tight">Imandou Food</h1><p id="restaurantDescription" class="text-[var(--muted)] mt-3 text-lg">أهلاً بكم في مطعمنا</p></header><div class="flex justify-center gap-2 mb-6 animate-slide-up" style="animation-delay: 0.2s;"><button class="pill lang-btn active" data-lang="ar">العربية</button><button class="pill lang-btn" data-lang="en">English</button><button class="pill lang-btn" data-lang="fr">Français</button></div><nav class="mb-6 sticky top-4 bg-[var(--bg)]/80 backdrop-blur-sm py-2 z-50 -mx-4 px-4 animate-slide-up" style="animation-delay: 0.3s;"><div id="categoriesContainer" class="categories-bar"></div></nav><main id="menuContainer" class="space-y-4"><div class="skeleton-card card"><div class="skeleton image"></div><div class="w-full"><div class="skeleton line w-3/4"></div><div class="skeleton line-sm w-full"></div><div class="skeleton line-sm w-1/2"></div></div></div><div class="skeleton-card card"><div class="skeleton image"></div><div class="w-full"><div class="skeleton line w-3/4"></div><div class="skeleton line-sm w-full"></div><div class="skeleton line-sm w-1/2"></div></div></div></main><footer class="text-center py-8 mt-8 border-t border-slate-800"><p class="text-sm text-slate-500">&copy; 2025 Imandou Food. جميع الحقوق محفوظة.</p></footer></div>
  <div id="cartFab" class="fab" role="button" aria-label="Open Cart"><i class="fas fa-shopping-basket"></i><span id="cartCount" class="badge-count">0</span></div>
  <div id="cartModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="cartModalTitle"><div class="modal-content card w-full max-w-lg max-h-[90vh] flex flex-col"><div class="modal-header p-5 flex justify-between items-center border-b border-slate-800"><h3 id="cartModalTitle" class="modal-title text-2xl">سلة المشتريات</h3><button class="close text-2xl" onclick="closeCartModal()">&times;</button></div><div id="cartItems" class="modal-body p-5 overflow-y-auto"></div><div class="modal-footer p-5 mt-auto border-t border-slate-800 flex justify-between items-center gap-4"><div><span id="totalText" class="text-slate-400">الإجمالي:</span><strong id="cartTotal" class="text-2xl">0 درهم</strong></div><button id="orderNowBtn" class="pill primary !text-base !py-3 !px-6" onclick="showConfirmOrderModal()"><i class="fas fa-check"></i> <span id="orderBtnText">اطلب الآن</span></button></div></div></div>
  <div id="confirmOrderModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="confirmModalTitle"><div class="modal-content card w-full max-w-md"><div class="modal-header p-5 flex justify-between items-center border-b border-slate-800"><h3 id="confirmModalTitle" class="modal-title text-2xl">تأكيد الطلب</h3><button class="close text-2xl" onclick="closeConfirmOrderModal()">&times;</button></div><div class="modal-body p-5"><div><label for="tableNumber" id="tableNumberLabel" class="block mb-2 font-medium">رقم الطاولة *</label><input type="number" id="tableNumber" class="form-input text-lg" placeholder="e.g., 12"></div><div><label for="orderNotes" id="orderNotesLabel" class="block mb-2 font-medium">ملاحظات (اختياري)</label><textarea id="orderNotes" class="form-input" rows="3" placeholder="مثال: بدون بصل..."></textarea></div></div><div class="modal-footer p-5 flex justify-end gap-3"><button class="pill secondary !py-2 !px-4" onclick="closeConfirmOrderModal()"><span id="cancelBtnText">إلغاء</span></button><button id="confirmOrderBtn" class="pill primary !py-2 !px-5" onclick="submitOrder()"><i class="fas fa-paper-plane"></i> <span id="confirmOrderBtnText">تأكيد</span></button></div></div></div>
  <div id="toastContainer" class="toast-container fixed top-5 right-5 z-[2000] w-full max-w-xs"></div>

  <script>
    // --- Firebase Configuration ---
    const firebaseConfig = {
      apiKey: "AIzaSyCyPOzsEzdrRd9o7iHASzFoLyJQhpTW83E",
      authDomain: "imandou-food.firebaseapp.com",
      databaseURL: "https://imandou-food-default-rtdb.firebaseio.com",
      projectId: "imandou-food"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // --- State Management ---
    const appState = {
        menu: [], categories: [], cart: [], lang: 'ar', currentCategory: 'all',
        dom: { menuContainer: document.getElementById('menuContainer'), categoriesContainer: document.getElementById('categoriesContainer'), cartFab: document.getElementById('cartFab'), cartCount: document.getElementById('cartCount'), cartModal: document.getElementById('cartModal'), cartItemsContainer: document.getElementById('cartItems'), cartTotalEl: document.getElementById('cartTotal'), confirmOrderModal: document.getElementById('confirmOrderModal'), },
    };
    
    // --- Translations (unchanged) ---
    const translations = { 'all_categories': { 'ar': 'الكل', 'en': 'All', 'fr': 'Tout' }, 'spicy': { 'ar': 'حار', 'en': 'Spicy', 'fr': 'Épicé' }, 'popular': { 'ar': 'شائع', 'en': 'Popular', 'fr': 'Populaire' }, 'add_to_cart': { 'ar': 'إضافة', 'en': 'Add', 'fr': 'Ajouter' }, 'added_to_cart': { 'ar': 'تمت الإضافة!', 'en': 'Added!', 'fr': 'Ajouté!' }, 'currency': { 'ar': 'درهم', 'en': 'MAD', 'fr': 'MAD' }, 'cart_title': { 'ar': 'سلة المشتريات', 'en': 'Your Cart', 'fr': 'Votre Panier' }, 'total': { 'ar': 'الإجمالي:', 'en': 'Total:', 'fr': 'Total:' }, 'order_now': { 'ar': 'اطلب الآن', 'en': 'Order Now', 'fr': 'Commander' }, 'empty_cart_message': { 'ar': 'سلتك فارغة. أضف بعض الأطباق الشهية!', 'en': 'Your cart is empty. Add some delicious dishes!', 'fr': 'Votre panier est vide. Ajoutez de délicieux plats!' }, 'confirm_order_title': { 'ar': 'تأكيد الطلب', 'en': 'Confirm Order', 'fr': 'Confirmer la commande' }, 'table_number': { 'ar': 'رقم الطاولة *', 'en': 'Table Number *', 'fr': 'Numéro de Table *' }, 'notes': { 'ar': 'ملاحظات (اختياري)', 'en': 'Notes (Optional)', 'fr': 'Notes (Optionnel)' }, 'cancel': { 'ar': 'إلغاء', 'en': 'Cancel', 'fr': 'Annuler' }, 'confirm': { 'ar': 'تأكيد', 'en': 'Confirm', 'fr': 'Confirmer' }, 'item_added_toast': { 'ar': 'تمت إضافة الصنف للسلة', 'en': 'Item added to cart', 'fr': 'Article ajouté au panier' }, 'table_required': { 'ar': 'الرجاء إدخال رقم الطاولة', 'en': 'Please enter table number', 'fr': 'Veuillez entrer le numéro de table' }, 'order_placed': { 'ar': 'تم إرسال طلبك بنجاح!', 'en': 'Your order has been placed successfully!', 'fr': 'Votre commande a été passée avec succès!' }, 'order_failed': { 'ar': 'فشل إرسال الطلب. الرجاء المحاولة مرة أخرى.', 'en': 'Failed to place order. Please try again.', 'fr': 'Échec de la commande. Veuillez réessayer.' }, };

    // --- App Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        loadCartFromStorage();
        loadDataFromFirebase();
        setupEventListeners();
        updateLanguageUI();
    });
    
    // NEW: Helper function to convert Firebase object to an array
    function firebaseObjectToArray(data) {
        if (!data) return [];
        return Object.keys(data).map(key => ({
            key, // Keep the unique Firebase key
            ...data[key]
        }));
    }

    // --- Data Handling (CHANGED) ---
    async function loadDataFromFirebase() {
        try {
            const [settingsSnap, categoriesSnap, menuSnap] = await Promise.all([
                database.ref('settings').once('value'),
                database.ref('categories').once('value'),
                database.ref('menu').once('value')
            ]);
            
            applySettings(settingsSnap.val() || {});
            // Convert the returned objects to arrays
            appState.categories = firebaseObjectToArray(categoriesSnap.val());
            appState.menu = firebaseObjectToArray(menuSnap.val());
            
            renderAll();
        } catch (error) {
            console.error("Error loading data:", error);
            appState.dom.menuContainer.innerHTML = `<p class="text-center text-danger">Failed to load menu.</p>`;
        }
    }
    
    // The rest of the script is unchanged, as it works correctly with the new array format
    function applySettings(settings) { if (settings.restaurantName) { document.getElementById('restaurantName').textContent = settings.restaurantName; document.title = `Menu - ${settings.restaurantName}`; } if (settings.restaurantDescription) { document.getElementById('restaurantDescription').textContent = settings.restaurantDescription; } if (settings.backgroundImage) { document.body.style.setProperty('--background-image', `url('${settings.backgroundImage}')`); } if (settings.accentColor) { document.documentElement.style.setProperty('--accent', settings.accentColor); } }
    function setupEventListeners() { document.querySelectorAll('.lang-btn').forEach(btn => { btn.addEventListener('click', () => { document.querySelector('.lang-btn.active').classList.remove('active'); btn.classList.add('active'); appState.lang = btn.dataset.lang; updateLanguageUI(); renderAll(); }); }); appState.dom.cartFab.addEventListener('click', () => { if (appState.cart.length > 0) openModal('cartModal'); }); }
    function renderAll() { renderCategories(); renderMenu(); renderCart(); }
    function renderCategories() { const { categoriesContainer } = appState.dom; categoriesContainer.innerHTML = ''; const createPill = (text, value, isActive) => { const btn = document.createElement('button'); btn.className = `pill ${isActive ? 'active' : ''}`; btn.textContent = text; btn.onclick = () => { appState.currentCategory = value; renderAll(); }; return btn; }; categoriesContainer.appendChild(createPill(translations.all_categories[appState.lang], 'all', appState.currentCategory === 'all')); appState.categories.filter(c => !c.hidden).forEach(cat => { const name = cat[`name_${appState.lang}`] || cat.name_en; categoriesContainer.appendChild(createPill(name, cat.name_ar, appState.currentCategory === cat.name_ar)); }); }
    function renderMenu() { const { menuContainer } = appState.dom; menuContainer.innerHTML = ''; const filteredMenu = appState.menu.filter(item => !item.hidden && (appState.currentCategory === 'all' || item.category === appState.currentCategory)); filteredMenu.forEach((item, index) => { const name = item[`name_${appState.lang}`] || item.name_en; const desc = item[`desc_${appState.lang}`] || item.desc_en; const card = document.createElement('div'); card.className = 'card menu-item-card opacity-0'; card.style.animationDelay = `${index * 50}ms`; card.innerHTML = ` <img src="${item.image || 'https://via.placeholder.com/150'}" alt="${name}" class="menu-item-image"> <div class="flex-1 flex flex-col"> <div class="flex justify-between items-start"> <h3 class="text-lg font-semibold">${name}</h3> <p class="text-lg font-bold text-[var(--accent)] whitespace-nowrap">${item.price} ${translations.currency[appState.lang]}</p> </div> <p class="text-sm text-[var(--muted)] mt-1 mb-3 flex-grow">${desc || ''}</p> <div class="flex justify-between items-center mt-auto"> <div> ${item.spicy ? `<span class="badge badge-spicy">${translations.spicy[appState.lang]}</span>` : ''} ${item.popular ? `<span class="badge badge-popular">${translations.popular[appState.lang]}</span>` : ''} </div> <button class="pill text-sm !px-4 !py-2" onclick="handleAddToCart(this, ${item.id})"> <i class="fas fa-plus"></i> <span>${translations.add_to_cart[appState.lang]}</span> </button> </div> </div>`; menuContainer.appendChild(card); setTimeout(() => card.classList.add('is-visible'), 50); }); }
    function renderCart() { const { cartItemsContainer, cartFab, cartCount, cartTotalEl } = appState.dom; const totalQuantity = appState.cart.reduce((sum, item) => sum + item.quantity, 0); if (totalQuantity === 0) { cartItemsContainer.innerHTML = ` <div class="text-center p-8"> <i class="fas fa-shopping-cart empty-cart-icon"></i> <p class="mt-4 text-lg text-[var(--muted)]">${translations.empty_cart_message[appState.lang]}</p> </div>`; cartFab.classList.remove('visible'); document.getElementById('orderNowBtn').disabled = true; } else { cartItemsContainer.innerHTML = ''; appState.cart.forEach(item => { const name = item[`name_${appState.lang}`] || item.name_en; const itemEl = document.createElement('div'); itemEl.className = 'cart-item flex items-center gap-4 mb-4'; itemEl.innerHTML = ` <img src="${item.image}" alt="${name}" class="w-20 h-20 object-cover rounded-md"> <div class="flex-grow"> <h4 class="font-semibold">${name}</h4> <p class="text-sm text-[var(--accent)] font-bold">${item.price * item.quantity} ${translations.currency[appState.lang]}</p> </div> <div class="quantity-controls flex items-center gap-2 bg-slate-800 rounded-full p-1"> <button class="quantity-btn w-8 h-8 rounded-full bg-slate-700" onclick="updateQuantity(${item.id}, 1)"><i class="fas fa-plus"></i></button> <span class="font-bold w-8 text-center">${item.quantity}</span> <button class="quantity-btn w-8 h-8 rounded-full bg-slate-700" onclick="updateQuantity(${item.id}, -1)"><i class="fas fa-minus"></i></button> </div>`; cartItemsContainer.appendChild(itemEl); }); cartFab.classList.add('visible'); document.getElementById('orderNowBtn').disabled = false; } cartCount.textContent = totalQuantity; const total = appState.cart.reduce((sum, item) => sum + item.price * item.quantity, 0); cartTotalEl.textContent = `${total} ${translations.currency[appState.lang]}`; saveCartToStorage(); }
    function handleAddToCart(btn, itemId) { const item = appState.menu.find(i => i.id === itemId); if (!item) return; const cartItem = appState.cart.find(i => i.id === itemId); if (cartItem) { cartItem.quantity++; } else { appState.cart.push({ ...item, quantity: 1 }); } btn.classList.add('added'); btn.innerHTML = `<i class="fas fa-check"></i> <span>${translations.added_to_cart[appState.lang]}</span>`; setTimeout(() => { btn.classList.remove('added'); btn.innerHTML = `<i class="fas fa-plus"></i> <span>${translations.add_to_cart[appState.lang]}</span>`; }, 1500); showToast(translations.item_added_toast[appState.lang], 'success'); renderCart(); }
    function updateQuantity(itemId, change) { let cartItem = appState.cart.find(i => i.id === itemId); if (cartItem) { cartItem.quantity += change; if (cartItem.quantity <= 0) { appState.cart = appState.cart.filter(i => i.id !== itemId); } } renderCart(); }
    function saveCartToStorage() { localStorage.setItem('imandouFoodCart', JSON.stringify(appState.cart)); }
    function loadCartFromStorage() { const savedCart = localStorage.getItem('imandouFoodCart'); if (savedCart) { appState.cart = JSON.parse(savedCart); } }
    function submitOrder() { const tableNumber = document.getElementById('tableNumber').value; if (!tableNumber) { showToast(translations.table_required[appState.lang], 'danger'); return; } const order = { tableNumber: tableNumber, notes: document.getElementById('orderNotes').value, items: appState.cart.map(item => ({ id: item.id, quantity: item.quantity, price: item.price, names: { ar: item.name_ar, en: item.name_en, fr: item.name_fr } })), totalPrice: appState.cart.reduce((sum, item) => sum + item.price * item.quantity, 0), timestamp: firebase.database.ServerValue.TIMESTAMP, status: 'new' }; database.ref('orders').push(order) .then(() => { showToast(translations.order_placed[appState.lang], 'success'); appState.cart = []; renderCart(); closeModal('confirmOrderModal'); document.getElementById('tableNumber').value = ''; document.getElementById('orderNotes').value = ''; }) .catch(error => { console.error("Order submission error:", error); showToast(translations.order_failed[appState.lang], 'danger'); }); }
    function updateLanguageUI() { const { lang } = appState; document.documentElement.lang = lang; document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr'; document.getElementById('cartModalTitle').innerText = translations.cart_title[lang]; document.getElementById('totalText').innerText = translations.total[lang]; document.getElementById('orderBtnText').innerText = translations.order_now[lang]; document.getElementById('confirmModalTitle').innerText = translations.confirm_order_title[lang]; document.getElementById('tableNumberLabel').innerText = translations.table_number[lang]; document.getElementById('orderNotesLabel').innerText = translations.notes[lang]; document.getElementById('cancelBtnText').innerText = translations.cancel[lang]; document.getElementById('confirmOrderBtnText').innerText = translations.confirm[lang]; }
    function openModal(modalId) { document.getElementById(modalId).classList.add('active'); } function closeModal(modalId) { document.getElementById(modalId).classList.remove('active'); } function closeCartModal() { closeModal('cartModal'); } function showConfirmOrderModal() { closeModal('cartModal'); openModal('confirmOrderModal'); } function closeConfirmOrderModal() { closeModal('confirmOrderModal'); }
    function showToast(message, type = 'success') { const toastContainer = document.getElementById('toastContainer'); const toast = document.createElement('div'); toast.className = `p-4 rounded-lg shadow-lg text-white animate-fade-in ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`; toast.textContent = message; toastContainer.prepend(toast); setTimeout(() => { toast.style.transition = 'opacity 0.5s ease'; toast.style.opacity = '0'; setTimeout(() => toast.remove(), 500); }, 3000); }
  </script>
</body>
</html>
